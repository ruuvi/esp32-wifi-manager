cmake_minimum_required(VERSION 3.5)

project(ruuvi_esp32-wifi-manager-tests)

add_definitions(
        -DRUUVI_TESTS=1
)

include_directories(
        esp_simul
)

enable_testing()
add_subdirectory(googletest)
add_subdirectory(posix_gcc_simulator)

include_directories(
        "posix_gcc_simulator/FreeRTOS_Posix"
        "posix_gcc_simulator/FreeRTOS_Posix/FreeRTOS_Kernel/include"
        "posix_gcc_simulator/FreeRTOS_Posix/FreeRTOS_Kernel/include/freertos"
        "posix_gcc_simulator/FreeRTOS_Posix/FreeRTOS_Kernel/portable/GCC/Posix"
)

add_subdirectory(lwip)

include_directories(
        "lwip/lwip/src/include"
        "lwip/extra"
        "lwip/lwip/contrib/ports/freertos/include"
        "lwip/lwip/contrib/ports/unix/port/include"
)

#include_directories(
#        "$ENV{IDF_PATH}/components/log/include/"
#        "$ENV{IDF_PATH}/components/esp_common/include/"
#        "$ENV{IDF_PATH}/components/esp_event/include/"
#        "$ENV{IDF_PATH}/components/"
#        "${CMAKE_BINARY_DIR}/../../../config/"
#)

add_subdirectory(test_str_buf)
add_subdirectory(test_json)
add_subdirectory(test_json_network_info)
add_subdirectory(test_json_access_points)
add_subdirectory(test_sta_ip_unsafe)

add_test(NAME test_str_buf
        COMMAND ruuvi_esp32-wifi-manager-test-str_buf
            --gtest_output=xml:$<TARGET_FILE_DIR:ruuvi_esp32-wifi-manager-test-str_buf>/gtestresults.xml
)

add_test(NAME test_json
        COMMAND ruuvi_esp32-wifi-manager-test-json
            --gtest_output=xml:$<TARGET_FILE_DIR:ruuvi_esp32-wifi-manager-test-json>/gtestresults.xml
)

add_test(NAME test_json_network_info
        COMMAND ruuvi_esp32-wifi-manager-test-json_network_info
            --gtest_output=xml:$<TARGET_FILE_DIR:ruuvi_esp32-wifi-manager-test-json_network_info>/gtestresults.xml
)

add_test(NAME test_json_access_points
        COMMAND ruuvi_esp32-wifi-manager-test-json_access_points
        --gtest_output=xml:$<TARGET_FILE_DIR:ruuvi_esp32-wifi-manager-test-json_access_points>/gtestresults.xml
)

add_test(NAME test_sta_ip_unsafe
        COMMAND ruuvi_esp32-wifi-manager-test-sta_ip_unsafe
        --gtest_output=xml:$<TARGET_FILE_DIR:ruuvi_esp32-wifi-manager-test-sta_ip_unsafe>/gtestresults.xml
)
